---
title: "final project -- modeling"
author: "Jason Tan"
date: "11/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(BAS)
```


```{r}
HOME <- "~/Desktop/STAT425/project/predictingcovid"
setwd(HOME)
COVARDATDIR <- paste(HOME, 'covardat', sep='/')
JHUDATDIR <- paste(HOME, 'jhudat', sep='/')

MASK_USE_PATH <- paste(COVARDATDIR, "mask-use-by-county.csv", sep='/')
MOBILITY_PATH <- paste(COVARDATDIR, "2020_US_Region_Mobility_Report.csv", sep='/')
SOCIECOWEATHER_PATH <- paste(COVARDATDIR, "US_counties_COVID19_health_weather_data_julyonly.csv", sep='/') # already filtered for july 15-26
JHU_PATH <- paste(JHUDATDIR, sep='/')
```

# Scaling and final tweaking to produce clean, ready to go .csv files and .rds files for easy loading

```{r}
clean <- read_csv(paste(HOME, 'cleaned_all_combined.csv', sep='/'), 
                  col_types = cols(
                        countyfips = col_factor(),
                        mean_confirmed_7d_total = col_double(),
                        mean_deaths_7d_total = col_double(),
                        mean_confirmed_7d_diff = col_double(),
                        mean_deaths_7d_diff = col_double(),
                        never_rarely_mask = col_double(),
                        retail_and_recreation_percent_change_from_baseline = col_double(),
                        workplaces_percent_change_from_baseline = col_double(),
                        stay_at_home = col_factor(),
                        population_density_per_sqmi = col_double(),
                        percent_uninsured = col_double(),
                        percent_non_hispanic_white = col_double(),
                        per_capita_income = col_double(),
                        percent_65_and_over = col_double(),
                        ELEV_M = col_double(),
                        mean_temp_15d_avg = col_double()
                        )
                  )
final_cases <- clean %>% 
    mutate(log_mean_confirmed_7d_total = log(mean_confirmed_7d_total)) %>% 
    select(-c(countyfips, mean_confirmed_7d_total, mean_confirmed_7d_diff, mean_deaths_7d_diff, mean_deaths_7d_total)) %>% 
    select(log_mean_confirmed_7d_total, everything())

final_deaths <- clean %>% 
    mutate(log_mean_deaths_7d_total = log(mean_deaths_7d_total + 1)) %>% 
    select(-c(countyfips, mean_confirmed_7d_total, mean_confirmed_7d_diff, mean_deaths_7d_diff, mean_deaths_7d_total)) %>% 
    select(log_mean_deaths_7d_total, everything())

# saveRDS(final_cases, paste(HOME, 'final_logcases_dat.rds', sep='/'))
# saveRDS(final_deaths, paste(HOME, 'final_logdeaths_dat.rds', sep='/'))
# write_csv(final_cases, paste(HOME, 'final_logcases_dat.csv', sep='/'))
# write_csv(final_deaths, paste(HOME, 'final_logdeaths_dat.csv', sep='/'))
```


# Playing around
```{r}
final_cases <- readRDS(paste(HOME, 'final_logcases_dat.rds', sep='/'))
y = final_cases$log_mean_confirmed_7d_total
X = final_cases %>% select(-log_mean_confirmed_7d_total) %>% mutate_if(is.numeric, scale)

# final_deaths <- readRDS(paste(HOME, 'final_logdeaths_dat.rds', sep='/'))
# y = final_deaths$log_mean_deaths_7d_total
# X = final_deaths %>% select(-log_mean_deaths_7d_total) %>% mutate_if(is.numeric, scale)

# plot(X)
caselm <- lm(y~., X)
summary(caselm) # misisng # of tests conducted
```

